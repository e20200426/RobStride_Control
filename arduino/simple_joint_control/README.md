# 简化关节控制程序

**最简单的关节位置控制，支持0-360度角度输入，专治振动**

## 🎯 项目特点

- ✅ **0-360度角度输入**（推荐！），超级直观
- ✅ **默认控制电机ID=11**，可动态修改
- ✅ **动态电机ID配置**，无需重新编译
- ✅ 配置自动保存，断电不丢失
- ✅ 超级简单，专注核心功能
- ✅ 最小振动，最优参数
- ✅ 智能识别角度/弧度输入
- ✅ 即插即用

## ⚙️ 默认配置

```cpp
电机ID: 11          # 默认控制电机ID=11
主机ID: 0
最大速度: 2.0 rad/s
位置KP: 30.0
转矩限制: 12.0 Nm
```

## 📱 控制命令

### 🎯 角度输入（推荐使用0-360度）
```bash
0              # 0度（正前方/起始位置）
90             # 顺时针90度
180            # 顺时针180度
270            # 顺时针270度
360            # 回到0度
45             # 顺时针45度
135            # 顺时针135度
```

### 📐 弧度输入（支持小弧度值）
```bash
1.57           # π/2弧度（90度）
3.14           # π弧度（180度）
-1.57          # -π/2弧度（-90度）
0              # 零点位置
```

### 🔧 控制命令
```bash
stop           # 立即停止
zero           # 设当前位置为零点
id X           # 设置电机ID为X (1-127)，默认为11
config         # 显示当前配置
restart        # 重启电机（更改ID后使用）
```

**注意**：程序默认控制电机ID=11，如果您的电机ID不是11，请使用 `id X` 命令修改

## 🎪 角度系统说明

### 角度对应关系
```
0°   = 起始位置/正前方
90°  = 顺时针转90度
180° = 顺时针转180度
270° = 顺时针转270度
360° = 回到起始位置（0°）
```

### 智能识别规则
- **0-360范围**：自动识别为角度 ✅
- **小弧度值**：自动识别为弧度
- **大于360度**：归一化到0-360度范围

## 🔧 优化参数

```cpp
最大速度: 2.0 rad/s        // 减少振动
位置KP:   20.0             // 保守增益
速度KP:   10.0             // 稳定响应
```

## 🚀 快速开始

1. **上传程序**
   - 打开 `simple_joint_control.ino`
   - 选择ESP32开发板
   - 上传程序

2. **开始控制**
   - 打开串口监视器（115200）
   - 直接输入位置数值
   - 观察电机平稳运动

## 📊 实时反馈

```
电机11: 位置 1.570 rad (90.0° -> 0-360°显示: 90.0°), 速度: 0.15 rad/s
电机11: 位置 1.571 rad (90.1° -> 0-360°显示: 90.1°), 速度: 0.05 rad/s
电机11: 位置 1.571 rad (90.1° -> 0-360°显示: 90.1°), 速度: 0.00 rad/s ✓ 到达
```

## 🎪 使用示例

### 角度控制测试（推荐）
```bash
0       # 0度（起始位置）
90      # 转到90度
180     # 转到180度
270     # 转到270度
360     # 回到0度
45      # 转到45度
135     # 转到135度
stop    # 停止
```

### 精确角度测试
```bash
22.5    # 22.5度
67.5    # 67.5度
112.5   # 112.5度
202.5   # 202.5度
0       # 回到0度
```

### 弧度控制（兼容模式）
```bash
1.57    # π/2弧度（自动识别为90度）
3.14    # π弧度（自动识别为180度）
-1.57   # -π/2弧度（保持负值）
0       # 零点
```

### 电机ID配置（新增功能）
```bash
config          # 查看当前配置（默认ID=11）
id 2            # 设置电机ID为2
config          # 再次查看，确认ID已更改
restart         # 重启电机应用新ID
90              # 测试：新ID电机转到90度
```

### 配置保存说明
```bash
- 配置自动保存到EEPROM
- 断电后配置不会丢失
- 首次运行使用默认配置（ID=11）
- 可随时更改电机ID（1-127）
```

### 如果您的电机ID不是11
```bash
# 假设您的电机实际ID是7
config          # 查看当前配置：ID=11
id 7            # 修改为ID=7
restart         # 重启应用新ID
90              # 测试控制电机ID=7
```

## ⚡ 优势

1. **🎯 角度输入**：0-360度，超级直观
2. **🔧 动态配置**：运行时更改电机ID，无需重新编译
3. **💾 配置保存**：自动保存到EEPROM，断电不丢失
4. **🧠 智能识别**：自动区分弧度/角度
5. **✨ 无振动**：经过优化的控制参数
6. **⚡ 响应快**：直接控制，无延迟
7. **🔒 稳定可靠**：简单就是稳定

## 🛡️ 安全特性

- **自动范围限制**：-12.5 到 12.5 弧度
- **角度归一化**：大于360度自动转换
- **智能识别**：0-360度优先识别为角度
- **动态ID设置**：1-127范围内任意设置
- **配置验证**：自动检查配置有效性
- **紧急停止**：随时输入"stop"立即停止
- **实时监控**：显示0-360度角度反馈和当前电机ID

## 📋 适用场景

- 🤖 机器人关节控制
- 🎯 精确角度定位
- ⚡ 快速原型开发
- 👨‍🏫 教学演示
- 🔬 测试验证

## 💡 使用技巧

1. **🎯 角度优先**：输入0-360范围内的数字会自动识别为角度
2. **🔧 ID配置**：使用"config"查看配置，"id X"更改电机ID
3. **📍 精确定位**：使用小数点位数获得更高精度，如22.5度
4. **⚡ 快速停止**：随时输入"stop"立即停止
5. **🔄 重新设零**：在任意位置输入"zero"设为新零点
6. **🔢 大角度处理**：输入450度会自动转换为90度
7. **💾 配置保存**：更改的电机ID会自动保存，断电不丢失

## 🔧 故障排除

### 电机不动？
- 检查CAN连接
- 确认电机电源
- 查看串口初始化信息
- 检查电机ID是否正确（使用"config"查看）
- **确认电机实际ID是否为11**，如果不是请使用 `id X` 命令修改

### 更改电机ID后没反应？
- 更改ID后必须输入"restart"重启电机
- 确认电机ID在1-127范围内
- 使用"config"确认设置是否生效

### 配置丢失？
- 首次运行会自动使用默认配置（ID=11）
- 检查EEPROM是否正常工作
- 重新设置后会自动保存

### 默认控制ID=11但电机不是11？
```bash
config          # 查看当前配置
id X            # X是您的电机实际ID
restart         # 重启应用
```

### 振动明显？
- 这是经过优化的程序，正常情况下振动很小
- 如果仍有振动，检查机械安装是否牢固

### 位置不准确？
- 重新设零：输入"zero"
- 检查是否有机械间隙
- 确认电机ID对应的电机是否正确

---

**提示**：如果需要更复杂的功能，请使用 `joint_position_control` 项目