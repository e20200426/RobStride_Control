# ⚡ 电机ID快速设置指南

## 🎯 5分钟快速设置多个电机ID

### 准备工作
1. **硬件连接**：
   - ESP32 + CAN模块
   - 小米电机 + 12-24V电源
   - CAN总线连接

2. **软件准备**：
   - 上传 `sim_setup_motor.ino` 到ESP32
   - 打开串口监视器（115200波特率）

3. **第一步测试**：
   ```bash
   test              # 测试CAN通信是否正常
   ```

---

## 🚀 方法一：批量设置（推荐）

### 步骤1：开始批量设置
```bash
batch 1
```
程序会提示：开始批量设置，从ID=1开始

### 步骤2：依次连接电机
```
=== 设置电机 #1 ===
请将电机连接到总线，然后输入任意键继续设置...
或输入 'stop' 结束批量设置
```
- **连接电机1** → 按任意键 → 自动设置为ID=1
- **连接电机2** → 按任意键 → 自动设置为ID=2
- **连接电机3** → 按任意键 → 自动设置为ID=3
- ... 继续直到所有电机设置完成

### 步骤3：验证设置
```bash
verify
```
输出示例：
```
验证结果：发现 3 个电机
当前电机ID: 1, 2, 3
✅ 电机数量充足，可以开始多电机控制
```

---

## 🔧 方法二：精确控制设置

### 设置单个电机
```bash
# 1. 连接电机到总线
test              # 先测试通信
scan              # 查看当前ID，输出：发现电机ID: 7

# 2. 修改ID
set 7 1           # 将ID=7改为ID=1

# 3. 验证修改
verify            # 确认修改成功
```

### 批量修改
```bash
# 设置机械臂6个关节
test              # 先测试通信
set 1 1           # 关节1 → ID=1 (换电机2)
set 1 2           # 关节2 → ID=2 (换电机3)
set 1 3           # 关节3 → ID=3 (换电机4)
set 1 4           # 关节4 → ID=4 (换电机5)
set 1 5           # 关节5 → ID=5 (换电机6)
set 1 6           # 关节6 → ID=6

# 最终验证
verify
```

---

## 📊 典型应用场景

### 场景1：3关节机械臂
```bash
# 目标：3个关节，ID=1,2,3
test              # 测试通信
batch 3           # 批量设置
# 依次连接3个电机，程序自动设置为ID=1,2,3
verify            # 验证：发现3个电机，ID: 1,2,3
```

### 场景2：4轮驱动小车
```bash
# 目标：4个轮子，ID=10,11,12,13
test              # 测试通信
set 1 10          # 前左轮
set 1 11          # 前右轮
set 1 12          # 后左轮
set 1 13          # 后右轮
verify            # 验证4个轮子电机
```

### 场景3：云台系统
```bash
# 目标：2轴云台，ID=20,21
test              # 测试通信
set 1 20          # 水平轴
set 1 21          # 垂直轴
scan 20 25        # 验证云台区域
```

---

## 🔍 故障排除

### 问题1：test命令失败
```
❌ CAN通信失败！
```
**解决方案**：
1. 检查CAN总线连接：CAN_H接CAN_H，CAN_L接CAN_L
2. 检查电机电源：12-24V，确保电源开启
3. 检查波特率：确保是1Mbps
4. 检查终端电阻：总线两端需要120Ω终端电阻

### 问题2：scan扫描不到电机
```
未发现任何电机
```
**解决方案**：
1. 先运行 `test` 命令检查基础通信
2. 只连接一个电机进行测试
3. 重新上电重启电机

### 问题3：set命令修改失败
```
❌ 修改失败，请检查连接或重试
```
**解决方案**：
1. 确保总线上只有一个电机
2. 重新运行 `test` 确认通信正常
3. 尝试 `reset 1` 重置电机后再设置

### 问题4：verify验证结果不对
```
发现电机数量比预期少
```
**解决方案**：
1. 可能存在ID冲突，重新设置ID
2. 逐一测试每个电机
3. 检查是否有电机未上电

---

## ⚠️ 重要提醒

### ❌ 不能这样做
```bash
# 错误：同时连接多个电机修改ID
# 会导致多个电机同时响应，ID混乱
```

### ✅ 正确做法
```bash
# 正确：一次只连接一个电机
# 每个电机单独设置ID
# 设置完成后断开，连接下一个
```

### 🔧 故障排除

#### 问题1：扫描不到电机
```bash
# 检查清单：
1. CAN连接线是否正确
2. 电机电源是否开启(12-24V)
3. 终端电阻是否配置
4. 波特率是否为1Mbps
```

#### 问题2：ID修改失败
```bash
reset 1               # 先重置电机
set 1 2               # 重新尝试修改
verify                 # 确认结果
```

#### 问题3：多个电机响应
```bash
# 解决方案：
1. 断开所有电机连接
2. 只连接目标电机
3. 重新设置ID
4. 验证成功后再连接下一个
```

---

## 💡 实用技巧

### 1. 快速测试
```bash
scan 1 5              # 只扫描前5个ID，速度快
```

### 2. ID规划
```bash
# 推荐ID分配：
1-10   : 关节电机
11-20  : 轮子电机
21-30  : 执行器
31-50  : 备用
```

### 3. 安全操作
```bash
# 每次修改后立即验证
set 1 5
verify
# 确认成功后再进行下一步
```

### 4. 记录管理
```
电机分配表：
ID=1 : 基座关节
ID=2 : 肩部关节
ID=3 : 肘部关节
ID=4 : 腕部关节
```

---

## 🎯 成功标志

设置成功的标志：
```
✓ 成功！电机ID已修改为: X
验证结果：发现 N 个电机
当前电机ID: 1, 2, 3, ...
✅ 电机数量充足，可以开始多电机控制
```

看到这些输出说明电机ID设置成功，可以开始多电机控制系统开发了！

---

**相关文件**：
- `sim_setup_motor.ino` - ID设置主程序
- `README.md` - 详细使用说明
- `simple_joint_control.ino` - 多电机控制程序（设置完ID后使用）