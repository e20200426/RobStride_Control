# 双电机控制程序

**同时控制两个小米电机，支持独立控制和同步控制**

## 🎯 项目特点

- ✅ **双电机独立控制**：分别控制电机1和电机2
- ✅ **同步控制模式**：两个电机同时运动到指定位置
- ✅ **0-360度角度输入**：直观的角度控制
- ✅ **动态ID配置**：运行时更改电机ID，无需重新编译
- ✅ **独立PID参数**：每个电机可单独调节响应特性
- ✅ **配置自动保存**：断电不丢失
- ✅ **实时状态监控**：显示两个电机的位置和速度

## 📱 控制命令

### 🎯 双电机控制（推荐）
```bash
90,180           # 电机1到90度，电机2到180度
0,0              # 双电机都回到0度
90,360           # 电机1到90度，电机2到360度(回零)
45,135           # 电机1到45度，电机2到135度
1.57,3.14        # 弧度输入：电机1到π/2，电机2到π
```

### 🎯 单电机控制
```bash
1-90             # 电机1转到90度
2-180            # 电机2转到180度
1-0              # 电机1回到0度
2-270            # 电机2转到270度
1-45             # 电机1转到45度
2-22.5           # 电机2转到22.5度
```

### 🔄 旧格式同步控制（兼容）
```bash
sync 90 180      # 电机1到90度，电机2到180度
sync 0 0         # 双电机都回到0度
sync 45 135      # 电机1到45度，电机2到135度
sync 180 90      # 电机1到180度，电机2到90度
```

### 📐 弧度输入支持
```bash
1-1.57           # 电机1转到π/2弧度(90度)
2-3.14           # 电机2转到π弧度(180度)
sync -1.57 1.57  # 电机1到-90度，电机2到90度
```

### ⚙️ 配置命令
```bash
id1 3            # 设置电机1ID为3
id2 4            # 设置电机2ID为4
config           # 显示当前配置
restart          # 重启双电机
```

### 🔧 参数调节
```bash
kp1 25           # 设置电机1位置KP
kp2 30           # 设置电机2位置KP
speed 3.0        # 设置双电机最大速度
```

### 📊 状态命令
```bash
status           # 显示双电机详细状态
stop             # 停止双电机
zero             # 设双电机零点
restart          # 重启双电机
help             # 显示帮助信息
```

## 🎪 应用场景

### 1. 机器人双关节控制
```bash
# 关节1和关节2协调运动
sync 0 0         # 双关节回到起始位置
sync 90 45       # 关节1到90度，关节2到45度
sync 180 90      # 关节1到180度，关节2到90度
sync 0 0         # 回到起始位置
```

### 2. 云台控制系统
```bash
# 水平和垂直轴控制
1-90             # 水平轴转到90度
2-45             # 垂直轴转到45度
sync 180 90      # 同时转到水平和垂直位置
sync 0 0         # 回到中心位置
```

### 3. 对称机构控制
```bash
# 对称运动，如夹爪开合
sync 30 -30      # 夹爪打开30度
sync 60 -60      # 夹爪打开60度
sync 0 0         # 夹爪关闭
```

### 4. 独立轮子控制
```bash
# 独立控制两个轮子
1-90             # 左轮前进
2-90             # 右轮前进
1-0              # 左轮停止
2-0              # 右轮停止
```

## 🔧 配置管理

### 默认配置
```cpp
电机1 ID: 1
电机2 ID: 2
主机ID: 0
最大速度: 2.0 rad/s
电机1位置KP: 30.0
电机2位置KP: 30.0
转矩限制: 12.0 Nm
```

### 更改电机ID
```bash
# 如果您的电机ID不是1和2
id1 11           # 电机1实际ID是11
id2 12           # 电机2实际ID是12
restart          # 重启应用新ID
```

### PID参数调节
```bash
# 如果电机响应太快或有振动
kp1 20           # 降低电机1的响应速度
kp2 25           # 降低电机2的响应速度

# 如果电机响应太慢
kp1 40           # 提高电机1的响应速度
kp2 45           # 提高电机2的响应速度
```

## 📊 实时状态监控

程序每2秒显示一次双电机状态：
```
电机1(ID=1): 位置 1.571 rad (90.0°), 速度: 0.15 rad/s
电机2(ID=2): 位置 0.785 rad (45.0°), 速度: 0.08 rad/s
```

## ⚡ 使用流程

### 1. 硬件连接
- ESP32 + CAN模块
- 两个小米电机 + 电源(12-24V)
- CAN总线连接

### 2. 上传程序
- 上传 `dual_motor_control.ino` 到ESP32
- 打开串口监视器（115200波特率）

### 3. 电机ID设置（如需要）
```bash
# 如果电机ID不是默认的1和2
id1 11           # 设置电机1 ID
id2 12           # 设置电机2 ID
restart          # 重启应用
```

### 4. 开始控制
```bash
# 测试单电机
1-90             # 电机1到90度
2-180            # 电机2到180度

# 测试同步控制
sync 45 135      # 双电机同步运动

# 查看状态
status           # 显示详细状态
```

## 🛡️ 安全特性

- **独立控制**：每个电机独立控制，互不干扰
- **范围限制**：自动限制到电机安全范围(-12到12弧度)
- **智能识别**：自动识别角度/弧度输入
- **参数验证**：自动检查参数有效性
- **紧急停止**：随时输入"stop"立即停止双电机
- **故障隔离**：一个电机故障不影响另一个

## 💡 使用技巧

### 1. 同步控制技巧
```bash
# 先小幅度测试
sync 10 10        # 小幅度同步运动
sync 45 45        # 中等幅度
sync 90 90        # 大幅度同步
```

### 2. 精确定位
```bash
# 使用小数点位数获得更高精度
1-22.5           # 精确22.5度
2-67.75          # 精确67.75度
sync 112.5 67.5   # 精确同步定位
```

### 3. 速度调节
```bash
# 需要快速响应
speed 5.0        # 提高速度

# 需要平滑运动
speed 1.0        # 降低速度
kp1 15           # 降低响应
kp2 15
```

### 4. 调试技巧
```bash
# 单独测试每个电机
1-90             # 只测试电机1
2-90             # 只测试电机2

# 检查状态
status           # 查看详细状态
config           # 检查配置
```

## 🔧 故障排除

### 电机无响应？
1. 检查CAN连接和电机电源
2. 确认电机ID设置是否正确（`config`查看）
3. 尝试单独控制每个电机

### 同步控制不同步？
1. 调节KP参数使两个电机响应一致
2. 检查机械负载是否均匀
3. 使用`status`查看实际位置差异

### 配置丢失？
- 首次运行会自动使用默认配置
- 重新设置后会自动保存

### 振动明显？
1. 降低KP参数
2. 降低运动速度
3. 检查机械安装

---

**总结**：这个双电机控制程序提供了完整的多电机控制能力，支持独立控制和同步控制，适用于各种需要协调运动的应用场景。